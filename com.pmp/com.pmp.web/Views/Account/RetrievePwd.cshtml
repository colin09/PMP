@{
    ViewBag.Title = "修改密码";
    Layout = "~/Views/Shared/_TaskLayout.cshtml";
}
<script src="~/Scripts/js/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/layer/layer.js"></script>
<script src="~/Scripts/Public.js"></script>
<style>
    .msgs {
        display: inline-block;
        width: 104px;
        color: #fff;
        font-size: 12px;
        border: 1px solid #0697DA;
        text-align: center;
        height: 30px;
        line-height: 30px;
        background: #0697DA;
        cursor: pointer;
    }

    msgs1 {
        background: #E6E6E6;
        color: #818080;
        border: 1px solid #CCCCCC;
    }
</style>

<div>
    <h3 class="ptb10">忘记密码</h3>
</div>

<div style="padding:15px">
    <div class="form-horizontal">
        <div class="form-group">
            <label for="user" class="col-sm-2 control-label">账  号：</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" name="user" id="user" placeholder="账号" required="required">
            </div>
        </div>
        <div class="form-group">
            <label for="pwd" class="col-sm-2 control-label">重置密码：</label>
            <div class="col-sm-10">
                <input type="password" class="form-control" name="pwd" id="pwd" placeholder="重置密码" required="required">
            </div>
        </div>
        <div class="form-group">
            <label for="Codes" class="col-sm-2 control-label">验证码：</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" name="Codes" id="Codes" style="width:150px;float:left" placeholder="验证码" required="required">
                <button class="msgs" style="float:left" id="btn_codes">获取验证码</button>
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
                <button class="btn btn_blue">修改</button>
            </div>
        </div>
    </div>
</div>
@section scripts{
    <script type="text/javascript">

        //获取短信验证码
        var validCode = true;
        $(".msgs").click(function () {


            if ($("#user").val() == "") {
                layer.msg("请输入账号!"); return;
            }

            if ($("#pwd").val() == "") {
                layer.msg("请输入密码!"); return;
            }

            var time = 60;
            var code = $(this);
            if (validCode) {
                validCode = false;
                code.addClass("msgs1");
                code.attr("disabled", true);
                var t = setInterval(function () {
                    time--;
                    code.html(time + "秒");
                    if (time == 0) {
                        clearInterval(t);
                        code.html("重新获取");
                        validCode = true;
                        code.removeClass("msgs1");
                        code.attr("disabled", false);
                    }
                }, 1000)
            }
        })


        $("#btn_codes").click(function () {
            if ($("#user").val() == "") {
                layer.msg("请输入账号!"); return;
            }

            if ($("#pwd").val() == "") {
                layer.msg("请输入密码!"); return;
            }
            var data = {
                user: $("#user").val()
            };
            $.get("/AM/CreateCode", data, function (res) {
                if (res == "True") {
                    layer.msg("发送成功!");
                } else {
                    layer.msg("发送失败!");
                }
            })
        });

        $(".btn_blue").click(function () {
            if ($("#user").val() == "") {
                layer.msg("请输入账号！"); return;
            }
            if ($("#pwd").val() == "") {
                layer.msg("请输入密码！"); return;
            }
            if ($("#Codes").val() == "") {
                layer.msg("请输入验证码！"); return;
            }
            var data = {
                user: $("#user").val(),
                pwd: $("#pwd").val(),
                Codes: $("#Codes").val()
            };
            $.get("/Account/RetrievePwdSumbit", data, function (res) {
                if (res.IsSuccess == "True") {
                    layer.msg(res.error);
                    //window.location.href = "/Account/login";
                } else {
                    layer.msg(res.error);
                }
            }, "json")
        });


        $("#user").blur(function () {
            if (!Public.IsMobile($("#user").val())) {
                $("#user").val("");
                layer.msg("账号格式错误！"); return;
            }
            $.get("/Account/IsExistPhone", { phone: $("#user").val() }, function (res) {
                if (res == "0") {
                    layer.msg("账号未注册");
                    $("#user").val("");
                }
            })
        });
    </script>
}

