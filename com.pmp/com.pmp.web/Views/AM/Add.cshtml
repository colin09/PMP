@{
    ViewBag.Title = "添加管理员";
    Layout = "~/Views/Shared/_TaskLayout.cshtml";
}
<script src="~/Scripts/Public.js"></script>
<style>
    .msgs {
        display: inline-block;
        width: 104px;
        color: #fff;
        font-size: 12px;
        border: 1px solid #0697DA;
        text-align: center;
        height: 30px;
        line-height: 30px;
        background: #0697DA;
        cursor: pointer;
    }

    msgs1 {
        background: #E6E6E6;
        color: #818080;
        border: 1px solid #CCCCCC;
    }
</style>
<div class="ptb10 bb">
    <span>添加管理员</span>
</div>
<div>
    <h3 class="ptb10">添加管理员</h3>
</div>
<div style="padding:15px ;width:600px">
    <div class="form-horizontal">
        <div class="form-group">
            <label for="user" class="col-sm-2 control-label">账  号：</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" name="user" id="user" value="" placeholder="手机号">
            </div>
        </div>
        <div class="form-group">
            <label for="newpwd" class="col-sm-2 control-label">密  码：</label>
            <div class="col-sm-10">
                <input type="password" class="form-control" name="newpwd" id="newpwd" value="" placeholder="密码">
            </div>
        </div>
        <div class="form-group">
            <label for="Codes" class="col-sm-2 control-label">验证码：</label>
            <div class="col-sm-10" style="width:300px">
                <input type="text" class="form-control" name="Codes" id="Codes" placeholder="验证码">

                <button class="msgs" id="btn_codes">获取验证码</button>
            </div>
        </div>
        <div class="form-group">
            <label for="key" class="col-sm-2 control-label">秘钥：</label>
            <div class="col-sm-10">
                <input type="password" class="form-control" name="key" id="key" placeholder="秘钥">
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
                <button class="btn btn_blue">添加</button>
            </div>
        </div>
    </div>
</div>
@section scripts{
    <script type="text/javascript">
        //获取短信验证码
        var validCode = true;
        $(".msgs").click(function () {
            var time = 60;
            var code = $(this);
            if (validCode) {
                validCode = false;
                code.addClass("msgs1");
                var t = setInterval(function () {
                    time--;
                    code.html(time + "秒");
                    if (time == 0) {
                        clearInterval(t);
                        code.html("重新获取");
                        validCode = true;
                        code.removeClass("msgs1");
                    }
                }, 1000)
            }
        })

        $("#user").blur(function () {
            if (!Public.IsMobile($("#user").val())) {
                $("#user").val("");
                alert("手机号格式错误！"); return;
            }
        });

        $("#btn_codes").click(function () {
            var data = {
                user: $("#user").val()
            };
            $.get("/AM/CreateCode", data, function (res) {
                if (res == "True") {
                    alert("发送成功!");
                } else {
                    alert("发送失败!");
                }
            })
        });

        $(".btn_blue").click(function () {
            if ($("#user").val() == "") {
                alert("请输入账号！"); return;
            }
            if ($("#newpwd").val() == "") {
                alert("请输入密码！"); return;
            }
            if ($("#Codes").val() == "") {
                alert("请输入验证码！"); return;
            }
            if ($("#kl").val() == "") {
                alert("密钥不能为空！"); return;
            }
            var data = {
                code: $("#user").val(),
                password: $("#newpwd").val(),
                key: $("#key").val(),
                Codes: $("#Codes").val()
            };
            $.get("/AM/AddAdmin", data, function (res) {
                if (res.IsSuccess == "False") {
                    alert(res.message);
                } else {
                    alert(res.message);
                    window.location.href = "/Account/Login";
                }
            }, "json")

        });

    </script>
}